# GitHub Continuous Integration Configuration
name: Regression

# Define conditions for when to run this action
on:
  pull_request: # Run on all pull requests
  push: # Run on all pushes to master
    branches:
      - main
      - develop

# A workflow run is made up of one or more jobs.  Each job has an id, for
# example, one of our jobs is "lint"
jobs:
  test:
    name: Tests ${{ matrix.python-version }}
    runs-on: ${{ matrix.os }}
    strategy:
      # Define OS and Python versions to use. We are only testing against one
      # Python version to conserve GH actions credits
      matrix:
        python-version: ["3.6", "3.x"]  # 3.x is the latest minor version
        os: [ubuntu-latest]

    # Sequence of tasks for this job
    steps:
      # Check out latest code using a pre-existing GH action
      # Docs: https://github.com/actions/checkout
      - name: Checkout code
        uses: actions/checkout@v2

      # Set up Python using a pre-existing GH action
      # Docs: https://github.com/actions/setup-python
      - name: Set up Python ${{ matrix.python-version }}
        uses: actions/setup-python@v2
        with:
          python-version: ${{ matrix.python-version }}

      # Install dependencies
      - name: Install dependencies
        run: |
          pip install -r requirements.txt
          pip install -e .[dev]

      # Run tests
      - name: Run linters, unit tests, and system tests
        run: ./test

      # Uncomment this chunk of YML code to open an SSH debug session to the GH
      # actions server in case of a hard-to-debug failure. The SSH session is
      # provided by tmate via a pre-existing GH action.
      # Docs: https://github.com/mxschmitt/action-tmate
      #
      # Warning: use this sparingly since it will consume GitHub action credits
      # until the SSH session is closed.
      # \/ UNCOMMENT \/
      # - name: Open SSH session on test failure
      #   if: ${{ failure() }}
      #   uses: mxschmitt/action-tmate@v3
      # /\ UNCOMMENT /\
